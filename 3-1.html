<script>
    // roomKey를 "room-3-1"로 수정하여 일관성 유지
    const roomKey = "room-3-1";
    
    document.getElementById('fileInput').addEventListener('change', function(event) {
        const preview = document.getElementById('preview');
        const files = event.target.files;
        
        let uploadedImages = JSON.parse(localStorage.getItem(roomKey + "-images")) || [];
        
        if (uploadedImages.length + files.length > 10) {
            alert("최대 10개의 이미지만 업로드할 수 있습니다.");
            return;
        }

        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            const reader = new FileReader();
            reader.onload = function(e) {
                const imgContainer = document.createElement('div');
                const img = document.createElement('img');
                img.src = e.target.result;
                
                const removeBtn = document.createElement('button');
                removeBtn.innerText = 'X';
                removeBtn.classList.add('remove-btn');
                removeBtn.addEventListener('click', function() {
                    uploadedImages = uploadedImages.filter(item => item !== img.src);
                    localStorage.setItem(roomKey + "-images", JSON.stringify(uploadedImages));
                    imgContainer.remove();
                });
                
                imgContainer.appendChild(img);
                imgContainer.appendChild(removeBtn);
                preview.appendChild(imgContainer);
                uploadedImages.push(img.src);
                localStorage.setItem(roomKey + "-images", JSON.stringify(uploadedImages));
            };
            reader.readAsDataURL(file);
        }
    });
    
    function saveText() {
        const textInput = document.getElementById("textInput").value;
        localStorage.setItem(roomKey + "-text", textInput);
        alert("저장되었습니다!");
    }
    
    window.onload = function() {
        const savedText = localStorage.getItem(roomKey + "-text");
        if (savedText) {
            document.getElementById("textInput").value = savedText;
        }
        
        const savedImages = JSON.parse(localStorage.getItem(roomKey + "-images")) || [];
        savedImages.forEach(src => {
            const imgContainer = document.createElement('div');
            const img = document.createElement('img');
            img.src = src;
            
            const removeBtn = document.createElement('button');
            removeBtn.innerText = 'X';
            removeBtn.classList.add('remove-btn');
            removeBtn.addEventListener('click', function() {
                let uploadedImages = JSON.parse(localStorage.getItem(roomKey + "-images")) || [];
                uploadedImages = uploadedImages.filter(item => item !== src);
                localStorage.setItem(roomKey + "-images", JSON.stringify(uploadedImages));
                imgContainer.remove();
            });
            
            imgContainer.appendChild(img);
            imgContainer.appendChild(removeBtn);
            document.getElementById('preview').appendChild(imgContainer);
        });
    };
</script>
